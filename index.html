<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مقارنة تفاعلية لأنظمة ERP في مصر والخليج</title>
    
    <!-- Chosen Palette: Calm Harmony (Light Gray/Slate, Dark Text, Teal Accent) -->
    <!-- Application Structure Plan: A dashboard-style SPA featuring a filterable, responsive card grid for ERP providers, a dynamic bar chart for price comparison, and modal windows for detailed views and side-by-side comparisons. This structure transforms a static table into an interactive tool, guiding users from a broad overview to specific details based on their needs (company size, budget, geography), which is more intuitive and engaging than a simple table. -->
    <!-- Visualization & Content Choices: Provider List -> Card Grid -> Filtering (HTML/JS) - For better UX. Price Data -> Bar Chart -> Interactive filtering (Chart.js) - For quick visual cost analysis. Detailed Info -> Modal -> Click interaction (JS) - To avoid clutter. Comparison -> Side-by-side Table in Modal -> Selection interaction (JS) - For focused decision-making. NO SVG/Mermaid used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 450px;
                max-height: 500px;
            }
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
        .filter-btn-active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            border-color: #0d9488;
        }
        .card-checkbox:checked + label {
            border-color: #0d9488;
            background-color: #ccfbf1;
        }
        .btn-primary {
            background-color: #14b8a6; /* teal-500 */
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #0d9488; /* teal-600 */
        }
        .btn-secondary {
            background-color: #f1f5f9; /* slate-100 */
            color: #0d9488; /* teal-600 */
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
             background-color: #e2e8f0; /* slate-200 */
        }
        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            background-color: #f1f5f9;
            color: #334155;
            transition: all 0.2s;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .social-icon:hover {
            background-color: #0d9488;
            color: white;
        }
        .social-icon:hover canvas {
            filter: brightness(0) invert(1);
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">مقارنة تفاعلية لأنظمة ERP في مصر والخليج</h1>
            <p class="mt-2 text-lg text-slate-600">أداة لمساعدتك على اختيار نظام تخطيط موارد المؤسسات الأنسب لعملك</p>
        </header>

        <main>
            <!-- Filter Controls -->
            <section id="filters" class="mb-8 p-6 bg-white rounded-xl shadow-md">
                <h2 class="text-xl font-bold mb-4 text-slate-700 text-center">فلترة الخيارات</h2>
                <div class="intro-paragraph mb-6 text-center">
                    <p class="text-slate-600">استخدم الفلاتر التالية لتضييق نطاق البحث وعرض الأنظمة التي تناسبك. سيتم تحديث كل من البطاقات والرسم البياني أدناه ليعكس اختيارك.</p>
                </div>
                <div class="flex flex-col items-center gap-6">
                    <div class="flex items-center gap-3 flex-wrap justify-center">
                        <span class="font-semibold">حجم الشركة:</span>
                        <button data-filter-group="size" data-filter="all" class="filter-btn size-filter filter-btn-active text-sm px-4 py-2 border rounded-full transition">الكل</button>
                        <button data-filter-group="size" data-filter="small" class="filter-btn size-filter text-sm px-4 py-2 border rounded-full transition">صغيرة ومتوسطة</button>
                        <button data-filter-group="size" data-filter="large" class="filter-btn size-filter text-sm px-4 py-2 border rounded-full transition">متوسطة وكبيرة</button>
                    </div>
                    <div class="flex items-center gap-3 flex-wrap justify-center">
                        <span class="font-semibold">الدولة (التواجد الرئيسي):</span>
                        <button data-filter-group="country" data-filter="all" class="filter-btn country-filter filter-btn-active text-sm px-4 py-2 border rounded-full transition">الكل</button>
                        <button data-filter-group="country" data-filter="Egypt" class="filter-btn country-filter text-sm px-4 py-2 border rounded-full transition">مصر</button>
                        <button data-filter-group="country" data-filter="KSA" class="filter-btn country-filter text-sm px-4 py-2 border rounded-full transition">السعودية</button>
                        <button data-filter-group="country" data-filter="UAE" class="filter-btn country-filter text-sm px-4 py-2 border rounded-full transition">الإمارات</button>
                    </div>
                    <div class="flex items-center gap-3 flex-wrap justify-center">
                        <span class="font-semibold">ترتيب حسب السعر:</span>
                        <button data-filter-group="sort" data-sort="default" class="filter-btn sort-filter filter-btn-active text-sm px-4 py-2 border rounded-full transition">افتراضي</button>
                        <button data-filter-group="sort" data-sort="lowest" class="filter-btn sort-filter text-sm px-4 py-2 border rounded-full transition">أقل سعر</button>
                        <button data-filter-group="sort" data-sort="highest" class="filter-btn sort-filter text-sm px-4 py-2 border rounded-full transition">أكثر سعر</button>
                    </div>
                </div>
            </section>

            <!-- Chart Section -->
            <section id="chart-section" class="mb-8 p-6 bg-white rounded-xl shadow-md">
                 <h2 class="text-xl font-bold mb-4 text-center text-slate-700">مقارنة تكلفة الاشتراك الشهري (بالدولار الأمريكي)</h2>
                 <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </section>
            
            <!-- Comparison Action Bar -->
            <div id="compare-bar" class="hidden sticky top-0 z-20 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg mb-6 items-center justify-between">
                <span id="compare-count" class="font-bold text-slate-700"></span>
                <button id="compare-btn" class="btn-primary font-bold py-2 px-6 rounded-lg">قارن الآن</button>
            </div>

            <!-- ERP Cards Grid -->
            <div id="erp-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Cards will be injected here by JavaScript -->
            </div>
        </main>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 opacity-0 pointer-events-none">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-11/12 md:w-3/4 lg:w-1/2 max-w-4xl max-h-[90vh] overflow-y-auto transform scale-95">
            <div id="modal-body" class="p-8">
                <!-- Modal content will be injected here -->
            </div>
            <button id="close-modal-btn" class="absolute top-4 left-4 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div id="compare-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 opacity-0 pointer-events-none">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-11/12 max-w-7xl max-h-[90vh] overflow-y-auto transform scale-95">
            <div class="p-6 md:p-8">
                <h2 class="text-2xl font-bold mb-6 text-center text-slate-800">مقارنة جنبًا إلى جنب</h2>
                <div id="compare-table-container" class="overflow-x-auto">
                    <!-- Comparison table will be injected here -->
                </div>
            </div>
             <button id="close-compare-modal-btn" class="absolute top-4 left-4 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
        </div>
    </div>

    <script>
        const erpData = [
            { id: 'netsuite', name: 'Oracle NetSuite', size: ['large'], countries: ['KSA', 'UAE', 'Qatar', 'Kuwait', 'Egypt'], website: 'https://www.netsuite.com', social: { linkedin: 'https://www.linkedin.com/company/netsuite/', twitter: 'https://twitter.com/NetSuite', facebook: 'https://www.facebook.com/NetSuite/', instagram: 'https://www.instagram.com/netsuite/', youtube: 'https://www.youtube.com/user/NetSuite', tiktok: '' }, country_notes: 'متوفر في جميع دول الخليج ومصر عبر شبكة واسعة من الشركاء المعتمدين.', features: ['إدارة مالية متقدمة', 'تخطيط سلاسل الإمداد والمخزون', 'إدارة علاقات العملاء (CRM)', 'تخطيط موارد التصنيع'], mobile: 'نعم، لديه تطبيق شامل.', priceText: 'مخصص (شهري وسنوي): يبدأ الترخيص الشهري من ~99$ للمستخدم، بالإضافة إلى رسوم أساسية. تتطلب الخطط السنوية عرض أسعار مخصص.', priceValue: 99, notes: 'الأقوى للعمليات المعقدة. يحتاج إلى شريك تنفيذ معتمد وتكلفة تطبيق وتخصيص عالية.' },
            { id: 'dynamics365', name: 'Microsoft Dynamics 365', size: ['all', 'small', 'large'], countries: ['KSA', 'UAE', 'Qatar', 'Kuwait', 'Bahrain', 'Oman', 'Egypt'], website: 'https://dynamics.microsoft.com/ar-sa/', social: { linkedin: 'https://www.linkedin.com/showcase/microsoft-dynamics-365/', twitter: 'https://twitter.com/MSFTDynamics365', facebook: 'https://www.facebook.com/msftdynamics365/', instagram: 'https://www.instagram.com/msftdynamics365/', youtube: 'https://www.youtube.com/channel/UCJGCg4rB3QSs8y_1Fgnb0Fw', tiktok: '' }, country_notes: 'متوفر بشكل كامل في جميع دول الخليج ومصر مع دعم محلي قوي من خلال شركاء مايكروسوفت.', features: ['تكامل عميق مع Microsoft 365', 'وحدات منفصلة (مالية، مبيعات..)', 'واجهة مألوفة', 'أدوات ذكاء اصطناعي (AI) مدمجة'], mobile: 'نعم، تطبيقات منفصلة لكل وحدة.', priceText: 'شهري وسنوي: تبدأ الباقات من ~65$ للمستخدم شهرياً. تتوفر التزامات سنوية بأسعار مختلفة.', priceValue: 65, notes: 'خيار ممتاز للشركات التي تعتمد على بيئة مايكروسوفت. متوافق مع الفوترة الإلكترونية.' },
            { id: 'sap', name: 'SAP', size: ['large'], countries: ['KSA', 'UAE', 'Qatar', 'Kuwait', 'Egypt'], website: 'https://www.sap.com/mena/index.html', social: { linkedin: 'https://www.linkedin.com/company/sap/', twitter: 'https://twitter.com/SAPMENA', facebook: 'https://www.facebook.com/SAPMENA/', instagram: 'https://www.instagram.com/sap/', youtube: 'https://www.youtube.com/user/SAP', tiktok: 'https://www.tiktok.com/@sap' }, country_notes: 'حضور قوي في الأسواق الرئيسية مثل السعودية والإمارات ومصر، خاصة للمشاريع الكبرى.', features: ['حلول متخصصة للصناعات', 'قوي جداً في إدارة العمليات المعقدة', 'تحليل بيانات متقدم'], mobile: 'نعم، عبر تطبيقات SAP Mobile.', priceText: 'مخصص (شهري وسنوي): حلول مثل SAP Business One تبدأ من ~100$ للمستخدم شهرياً. تتطلب الخطط السنوية عرض أسعار.', priceValue: 100, notes: 'قائد عالمي في السوق. يتطلب شريك تنفيذ معتمد وتكاليف تطبيق وتخصيص مرتفعة.' },
            { id: 'daftra', name: 'دفترة (Daftra)', size: ['small'], countries: ['KSA', 'UAE', 'Egypt'], website: 'https://www.daftra.com/', social: { linkedin: 'https://www.linkedin.com/company/daftra/', twitter: 'https://twitter.com/daftra', facebook: 'https://www.facebook.com/Daftra/', instagram: 'https://www.instagram.com/daftraapp/', youtube: 'https://www.youtube.com/c/Daftra', tiktok: '' }, country_notes: 'يركز بشكل أساسي على السوق السعودي والإماراتي والمصري، مع دعم كامل للوائح المحلية في كل دولة.', features: ['متوافق مع الفوترة الإلكترونية (ZATCA و ETA)', 'محاسبة، فواتير، مخزون، موارد بشرية', 'نقاط بيع (POS)', 'دعم فني وواجهات باللغة العربية'], mobile: 'نعم، لديه تطبيق لإدارة الأعمال.', priceText: 'شهري وسنوي: تبدأ الباقات من ~15$ شهرياً. الباقة الشاملة ~50$ شهرياً، مع خصم عند الاشتراك السنوي.', priceValue: 15, notes: 'الأسهل والأسرع للتوافق المحلي في مصر والسعودية. الحل الأمثل للشركات الصغيرة والمتوسطة.' },
            { id: 'qoyod', name: 'قيود (Qoyod)', size: ['small'], countries: ['KSA'], website: 'https://qoyod.com', social: { linkedin: 'https://www.linkedin.com/company/qoyod/', twitter: 'https://twitter.com/qoyodsa', facebook: 'https://www.facebook.com/QoyodSA/', instagram: 'https://www.instagram.com/qoyodsa/', youtube: 'https://www.youtube.com/channel/UC2g_iPY2yq2R4j4iHk3h96Q', tiktok: 'https://www.tiktok.com/@qoyodsa' }, country_notes: 'حل سعودي 100%، مصمم ومخصص للسوق السعودي فقط ومتوافق بشكل كامل مع أنظمة هيئة الزكاة والضريبة والجمارك.', features: ['حل سعودي متخصص ومتوافق تماماً مع ZATCA', 'يركز بشكل أساسي على المحاسبة والفواتير', 'إدارة العملاء والموردين', 'نقاط بيع وربط مع المتاجر الإلكترونية'], mobile: 'نعم، لديه تطبيق شامل وسهل.', priceText: 'شهري وسنوي: تبدأ من 120 ريال (~32$) شهرياً، أو 1200 ريال (~320$) سنوياً (خصم شهرين).', priceValue: 32, notes: 'خيار محلي ممتاز، مثالي لمن أولويته القصوى هي المحاسبة المتوافقة مع الأنظمة السعودية.' },
            { id: 'odoo', name: 'Odoo (أودو)', size: ['small'], countries: ['KSA', 'UAE', 'Kuwait', 'Bahrain', 'Egypt'], website: 'https://www.odoo.com/ar_SA', social: { linkedin: 'https://www.linkedin.com/company/odoo/', twitter: 'https://twitter.com/Odoo', facebook: 'https://www.facebook.com/odoo', instagram: 'https://www.instagram.com/odoo.official/', youtube: 'https://www.youtube.com/user/OdooTV', tiktok: 'https://www.tiktok.com/@odoo' }, country_notes: 'متوفر في جميع دول الخليج ومصر عبر شبكة واسعة من الشركاء المحليين الذين يقومون بالتنفيذ والتخصيص.', features: ['نظام معياري (اختر ما تحتاجه فقط)', 'مرونة فائقة وقابلية للتخصيص', 'تطبيقات للمبيعات، محاسبة، مخزون، تصنيع، وغيرها.'], mobile: 'نعم، لديه تطبيق أساسي وتطبيقات متخصصة.', priceText: 'شهري (يُدفع سنوياً): يبدأ من ~25$ - 35$ للمستخدم الواحد مع باقة التطبيقات الكاملة. الفوترة تتم بشكل سنوي.', priceValue: 25, notes: 'خيار مثالي لمن يريد البدء بشكل صغير ثم التوسع. يتطلب شريكاً تقنياً للتخصيص.' },
            { id: 'zoho', name: 'Zoho ERP (زوهو)', size: ['small'], countries: ['KSA', 'UAE', 'Qatar', 'Kuwait', 'Bahrain', 'Oman', 'Egypt'], website: 'https://www.zoho.com/ar/one/', social: { linkedin: 'https://www.linkedin.com/company/zoho/', twitter: 'https://twitter.com/zoho', facebook: 'https://www.facebook.com/zoho', instagram: 'https://www.instagram.com/zoho/', youtube: 'https://www.youtube.com/user/zoho', tiktok: 'https://www.tiktok.com/@zoho' }, country_notes: 'حضور عالمي قوي مع دعم جيد في منطقة الخليج ومصر، خاصة في السعودية والإمارات.', features: ['حزمة Zoho One تشمل أكثر من 40 تطبيقاً', 'نظام مالي، CRM، موارد بشرية، وغيرها.', 'قيمة استثنائية مقابل السعر.'], mobile: 'نعم، لكل تطبيق تقريباً تطبيق خاص به.', priceText: 'شهري وسنوي: تبدأ من ~35$ للمستخدم شهرياً (عند الدفع السنوي)، أو ~45$ للمستخدم (عند الدفع الشهري).', priceValue: 35, notes: 'يقدم أكبر حزمة من التطبيقات المتكاملة بسعر لا ينافس. حل عالمي قوي ويدعم متطلبات السوق المحلي.' },
            { id: 'sage', name: 'Sage (سيج)', size: ['small'], countries: ['KSA', 'UAE', 'Egypt'], website: 'https://www.sage.com/en-za/', social: { linkedin: 'https://www.linkedin.com/company/sage-software/', twitter: 'https://twitter.com/Sagegroupplc', facebook: 'https://www.facebook.com/Sage/', instagram: 'https://www.instagram.com/sageofficial/', youtube: 'https://www.youtube.com/user/SageSoftware', tiktok: 'https://www.tiktok.com/@sageofficial' }, country_notes: 'متوفر في السعودية والإمارات ومصر عبر شركاء محليين، ويركز بشكل كبير على الحلول المالية.', features: ['حلول قوية في المحاسبة والإدارة المالية', 'حلول متخصصة مثل Sage Intacct', 'إدارة الرواتب والموارد البشرية'], mobile: 'نعم، تتوفر تطبيقات جوال لمعظم منتجاتها.', priceText: 'شهري وسنوي: تبدأ الباقات البسيطة من ~29$ شهرياً. تتوفر خطط سنوية.', priceValue: 29, notes: 'شركة عالمية عريقة. تحتاج إلى شريك محلي لضمان التطبيق الصحيح والتوافق المحلي.' },
            { id: 'infor', name: 'Infor', size: ['large'], countries: ['KSA', 'UAE', 'Qatar', 'Egypt'], website: 'https://www.infor.com/en-gb', social: { linkedin: 'https://www.linkedin.com/company/infor/', twitter: 'https://twitter.com/infor', facebook: 'https://www.facebook.com/infor/', instagram: 'https://www.instagram.com/infor/', youtube: 'https://www.youtube.com/user/infor', tiktok: '' }, country_notes: 'متوفر في الأسواق الكبرى للشركات الكبيرة في قطاعات التصنيع والتوزيع والخدمات اللوجستية.', features: ['حلول متخصصة للصناعات (تصنيع، توزيع)', 'CloudSuite ERP', 'تحليلات أعمال متقدمة', 'إدارة أصول المؤسسة (EAM)'], mobile: 'نعم، توفر تطبيقات Infor Go.', priceText: 'مخصص (شهري وسنوي): يعتمد على الحل المحدد وعدد المستخدمين. يعتبر من الفئة المرتفعة.', priceValue: 150, notes: 'لاعب عالمي كبير متخصص في قطاعات معينة. يتطلب شريك تنفيذ متخصص.' },
            { id: 'focus', name: 'Focus Softnet', size: ['all', 'small', 'large'], countries: ['KSA', 'UAE', 'Qatar', 'Kuwait', 'Bahrain', 'Oman', 'Egypt'], website: 'https://www.focussoftnet.com', social: { linkedin: 'https://www.linkedin.com/company/focus-softnet/', twitter: 'https://twitter.com/focussoftnet', facebook: 'https://www.facebook.com/focussoftnet/', instagram: 'https://www.instagram.com/focussoftnet/', youtube: 'https://www.youtube.com/channel/UCTi-o_I7sI2OaH1A2I2jR0Q', tiktok: '' }, country_notes: 'حضور قوي جداً في جميع دول الخليج ومصر مع مكاتب محلية في معظمها، مما يوفر دعماً قوياً.', features: ['نظام Focus X السحابي', 'وحدات متكاملة (مالية، موارد بشرية، نقاط بيع)', 'حلول متخصصة لقطاعات مختلفة', 'إدارة علاقات العملاء مدمجة'], mobile: 'نعم، لديهم تطبيق Focus X.', priceText: 'اشتراك (شهري وسنوي): باقات تنافسية تعتمد على الوحدات والمستخدمين. تبدأ من ~40$ شهرياً.', priceValue: 40, notes: 'مزود إقليمي له حضور قوي، يفهم متطلبات السوق المحلي في الخليج ومصر.' },
            { id: 'ultimate', name: 'الحلول النهائية', size: ['all', 'small', 'large'], countries: ['KSA', 'Yemen', 'Egypt'], website: 'https://ultimate-sa.com', social: { linkedin: 'https://www.linkedin.com/company/ultimate-solutions-co-ltd/', twitter: 'https://twitter.com/Ultimate_S_S', facebook: 'https://www.facebook.com/UltimateSolutionsCo/', instagram: '', youtube: 'https://www.youtube.com/channel/UC-l2a1Kj3s-y2xwYt_j7gAQ', tiktok: '' }, country_notes: 'مزود سعودي رائد، يركز بشكل أساسي على السوق السعودي واليمني وله تواجد في مصر.', features: ['نظام ONYX Pro ERP', 'قوي في الإدارة المالية والموارد البشرية', 'مصمم خصيصاً للسوق العربي', 'متوافق مع الأنظمة المحلية'], mobile: 'نعم، لديهم تطبيق ONYX Pro Mobile.', priceText: 'مخصص (اشتراك أو ترخيص دائم): يعتمد على الوحدات والمستخدمين. يوفر نماذج اشتراك سنوية وترخيص دائم.', priceValue: 50, notes: 'مزود سعودي رائد، يعتبر من أقوى الحلول الإقليمية وله فهم عميق للوائح والبيئة التجارية.' },
            { id: 'epicor', name: 'Epicor', size: ['large'], countries: ['KSA', 'UAE', 'Egypt'], website: 'https://www.epicor.com', social: { linkedin: 'https://www.linkedin.com/company/epicor/', twitter: 'https://twitter.com/Epicor', facebook: 'https://www.facebook.com/epicor/', instagram: 'https://www.instagram.com/epicor/', youtube: 'https://www.youtube.com/user/EpicorSoftware', tiktok: 'https://www.tiktok.com/@epicor' }, country_notes: 'متوفر في السعودية والإمارات ومصر عبر شركاء متخصصين، مع تركيز قوي على قطاعات التصنيع والتوزيع.', features: ['حلول متخصصة للصناعات', 'إدارة مالية وتصنيع متقدمة', 'تحليلات مدمجة', 'Cloud و On-Premise'], mobile: 'نعم، يوفر تطبيقات Epicor Mobile.', priceText: 'مخصص (شهري وسنوي): يعتمد على حجم المشروع والوحدات. يعتبر من الفئة المتوسطة إلى المرتفعة.', priceValue: 120, notes: 'منافس قوي في قطاع التصنيع، يتطلب شريك تنفيذ متخصص لفهم احتياجات السوق.' },
            { id: 'tally', name: 'TallyPrime', size: ['small'], countries: ['KSA', 'UAE', 'Bahrain', 'Oman', 'Kuwait', 'Egypt'], website: 'https://tallysolutions.com/mena/', social: { linkedin: 'https://www.linkedin.com/company/tally-solutions-pvt-ltd/', twitter: 'https://twitter.com/TallySolutions', facebook: 'https://www.facebook.com/TallySolutions/', instagram: 'https://www.instagram.com/tallysolutions.official/', youtube: 'https://www.youtube.com/user/tallysolution', tiktok: '' }, country_notes: 'شعبية واسعة بين الشركات الصغيرة والمتوسطة في جميع أنحاء الخليج ومصر، خاصة في قطاع التجارة.', features: ['محاسبة قوية جداً', 'إدارة المخزون', 'متوافق مع ضريبة القيمة المضافة', 'سهولة الاستخدام'], mobile: 'نعم، عبر تطبيقات شركاء (Tally on Mobile).', priceText: 'سنوي أو دائم: يبدأ الاشتراك السنوي من ~240$ (أي ما يعادل 20$ شهرياً). يتوفر ترخيص دائم.', priceValue: 20, notes: 'يعتبر معياراً في المحاسبة للشركات الصغيرة، لكنه ليس نظام ERP متكامل بالمعنى التقليدي.' },
            { id: 'alameen', name: 'برنامج الأمين', size: ['small'], countries: ['KSA', 'UAE', 'Kuwait', 'Jordan', 'Syria', 'Egypt'], website: 'https://alameensoft.com/ar/', social: { linkedin: 'https://www.linkedin.com/company/alameensoft/', twitter: 'https://twitter.com/alameensoft', facebook: 'https://www.facebook.com/alameensoft', instagram: '', youtube: 'https://www.youtube.com/user/alameenerp', tiktok: '' }, country_notes: 'مزود إقليمي قوي له انتشار واسع في السعودية ودول الخليج والشام ومصر.', features: ['محاسبة ومستودعات', 'حلول نقاط البيع', 'إدارة التصنيع', 'متوافق مع الأنظمة المحلية'], mobile: 'نعم، يوفر تطبيقات موبايل مرتبطة.', priceText: 'ترخيص دائم: يعتمد السعر على الوحدات المطلوبة، يعتبر من الفئة الاقتصادية إلى المتوسطة. (تقدير شهري للمقارنة فقط).', priceValue: 30, notes: 'حل عربي قوي ومشهور، خاصة بين الشركات التجارية الصغيرة والمتوسطة.' },
            { id: 'hesabate', name: 'HESABATE (حساباتي)', size: ['small'], countries: ['Egypt', 'Jordan', 'KSA', 'UAE'], website: 'https://hesabate.com', social: { linkedin: 'https://www.linkedin.com/company/hesabate/', twitter: 'https://twitter.com/hesabate', facebook: 'https://www.facebook.com/Hesabate/', instagram: 'https://www.instagram.com/hesabate/', youtube: 'https://www.youtube.com/c/Hesabate', tiktok: 'https://www.tiktok.com/@hesabate' }, country_notes: 'حل إقليمي قوي مع تركيز كبير على السوق المصري والأردني، ومتوافق مع الفاتورة الإلكترونية المصرية.', features: ['محاسبة متكاملة', 'إدارة المخزون ونقاط البيع', 'إدارة المشاريع والموظفين', 'متوافق مع الفاتورة الإلكترونية المصرية'], mobile: 'نعم، يوفر تطبيق موبايل شامل.', priceText: 'سنوي: تبدأ الباقات من 300$ سنوياً (أي ما يعادل 25$ شهرياً).', priceValue: 25, notes: 'خيار قوي جداً للشركات الصغيرة والمتوسطة في مصر، يجمع بين المحاسبة وإدارة المشاريع.' },
            { id: 'ifs', name: 'IFS', size: ['large'], countries: ['KSA', 'UAE'], website: 'https://www.ifs.com/corp/', social: { linkedin: 'https://www.linkedin.com/company/ifs/', twitter: 'https://twitter.com/ifs', facebook: 'https://www.facebook.com/IFSworld/', instagram: 'https://www.instagram.com/ifsworld/', youtube: 'https://www.youtube.com/channel/UCbv38t2e2t0166H315g6-PA', tiktok: '' }, country_notes: 'شركة عالمية رائدة في حلول إدارة الأصول (EAM) والخدمات الميدانية (FSM)، قوية في قطاعات الطيران والدفاع والطاقة في السعودية والإمارات.', features: ['إدارة أصول المؤسسة (EAM)', 'إدارة المشاريع', 'إدارة سلسلة التوريد', 'حلول متخصصة للصناعات'], mobile: 'نعم، عبر تطبيقات IFS Aurena.', priceText: 'مخصص (شهري وسنوي): يعتمد على حجم المشروع والوحدات. يعتبر من الفئة المرتفعة.', priceValue: 160, notes: 'خيار قوي للشركات الكبيرة التي لديها عمليات معقدة في إدارة الأصول والخدمات الميدانية.' },
            { id: 'syspro', name: 'SYSPRO', size: ['large'], countries: ['KSA', 'UAE', 'Egypt'], website: 'https://www.syspro.com/', social: { linkedin: 'https://www.linkedin.com/company/syspro/', twitter: 'https://twitter.com/SYSPRO', facebook: 'https://www.facebook.com/SYSPRO', instagram: 'https://www.instagram.com/syspro_erp/', youtube: 'https://www.youtube.com/user/SYSPROerp', tiktok: '' }, country_notes: 'متوفر في المنطقة عبر شركاء، قوي جداً في قطاعات التصنيع والتوزيع للشركات المتوسطة والكبيرة.', features: ['متخصص في التصنيع والتوزيع', 'إدارة المخزون المتقدمة', 'تخطيط متطلبات المواد (MRP)', 'إدارة جودة'], mobile: 'نعم، يوفر تطبيق SYSPRO Mobile.', priceText: 'مخصص (شهري وسنوي): يعتمد على عدد المستخدمين والوحدات. يعتبر من الفئة المرتفعة.', priceValue: 155, notes: 'خيار مثالي للشركات الصناعية التي تحتاج إلى نظام متخصص وعميق.' },
            { id: 'acumatica', name: 'Acumatica', size: ['all', 'small', 'large'], countries: ['KSA', 'UAE', 'Egypt'], website: 'https://www.acumatica.com/', social: { linkedin: 'https://www.linkedin.com/company/acumatica/', twitter: 'https://twitter.com/Acumatica', facebook: 'https://www.facebook.com/Acumatica/', instagram: 'https://www.instagram.com/acumatica/', youtube: 'https://www.youtube.com/user/acumatica', tiktok: '' }, country_notes: 'متوفر في المنطقة عبر شركاء. معروف بنموذج تسعير يعتمد على الموارد وليس عدد المستخدمين.', features: ['حلول متخصصة (مقاولات، تجارة)', 'نموذج تسعير فريد', 'سحابي بالكامل', 'قابلية عالية للتخصيص'], mobile: 'نعم، تطبيق Acumatica Mobile متوفر.', priceText: 'مخصص (سنوي): يعتمد على التطبيقات والموارد المستهلكة، وليس عدد المستخدمين. (تقدير شهري للمقارنة).', priceValue: 130, notes: 'خيار جذاب للشركات النامية التي لا ترغب في تقييد عدد المستخدمين.' },
            { id: 'ramco', name: 'Ramco Systems', size: ['large'], countries: ['KSA', 'UAE'], website: 'https://www.ramco.com/', social: { linkedin: 'https://www.linkedin.com/company/ramco-systems/', twitter: 'https://twitter.com/RamcoSystems', facebook: 'https://www.facebook.com/RamcoSystems/', instagram: 'https://www.instagram.com/ramcosystems/', youtube: 'https://www.youtube.com/user/RamcoSystems', tiktok: '' }, country_notes: 'له حضور قوي في السعودية والإمارات، خاصة في قطاعات الطيران والخدمات اللوجستية والموارد البشرية.', features: ['إدارة موارد بشرية ورواتب قوية', 'إدارة صيانة الطيران', 'إدارة الخدمات اللوجستية', 'إدارة مالية'], mobile: 'نعم، يوفر تطبيقات موبايل.', priceText: 'مخصص (شهري وسنوي): يعتمد على حجم المشروع والوحدات.', priceValue: 140, notes: 'حل قوي ومبتكر، خاصة في إدارة الموارد البشرية والطيران.' },
            { id: 'bayanat_erp', name: 'Bayanat ERP', size: ['all', 'small', 'large'], countries: ['KSA'], website: 'https://bayanat.com.sa/', social: { linkedin: 'https://www.linkedin.com/company/bayanat-sa/', twitter: 'https://twitter.com/bayanat_sa', facebook: '', instagram: '', youtube: '', tiktok: '' }, country_notes: 'شركة سعودية تقدم حلولاً متكاملة لمختلف القطاعات في المملكة.', features: ['حلول متخصصة للقطاع الحكومي والخاص', 'إدارة مالية وموارد بشرية', 'متوافق مع الأنظمة المحلية', 'خدمات استشارية'], mobile: 'نعم، يوفر تطبيقات مرتبطة.', priceText: 'مخصص (شهري وسنوي): يعتمد على حجم المشروع.', priceValue: 65, notes: 'لاعب محلي قوي يتمتع بخبرة في تنفيذ المشاريع الكبيرة داخل المملكة.' },
            { id: 'optimal', name: 'Optimal ERP', size: ['small'], countries: ['Egypt', 'KSA'], website: 'https://www.optimal.com.co/', social: { linkedin: 'https://www.linkedin.com/company/optimal-business-solutions/', twitter: '', facebook: '', instagram: '', youtube: '', tiktok: '' }, country_notes: 'حل إقليمي يركز على قطاع الضيافة والمطاعم في مصر والسعودية.', features: ['متخصص في المطاعم والفنادق', 'إدارة نقاط البيع', 'إدارة المخزون والتكاليف', 'تقارير متخصصة'], mobile: 'نعم، يوفر تطبيقات موبايل.', priceText: 'مخصص (شهري وسنوي): يعتمد على حجم المنشأة.', priceValue: 35, notes: 'خيار مثالي لقطاع الضيافة الذي يحتاج إلى حلول متخصصة.' },
            { id: 'realsoft', name: 'RealSoft', size: ['all', 'small', 'large'], countries: ['KSA', 'UAE', 'Jordan'], website: 'https://www.realsoft-me.com/', social: { linkedin: 'https://www.linkedin.com/company/realsoft-advanced-applications/', twitter: '', facebook: 'https://www.facebook.com/RealSoftCo/', instagram: '', youtube: '', tiktok: '' }, country_notes: 'شركة أردنية لها حضور في السعودية والإمارات، وتقدم حلولاً متنوعة.', features: ['حلول متخصصة (تأمين، بنوك)', 'إدارة الوثائق والأرشفة', 'إدارة الموارد البشرية', 'حلول قابلة للتخصيص'], mobile: 'نعم، يوفر تطبيقات مرتبطة.', priceText: 'مخصص (شهري وسنوي): يعتمد على المشروع.', priceValue: 70, notes: 'قوي في قطاعات محددة مثل التأمين والقطاع المالي.' }
        ];

        const erpGrid = document.getElementById('erp-grid');
        const detailModal = document.getElementById('detail-modal');
        const compareModal = document.getElementById('compare-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const closeCompareModalBtn = document.getElementById('close-compare-modal-btn');
        const modalBody = document.getElementById('modal-body');
        const compareBar = document.getElementById('compare-bar');
        const compareBtn = document.getElementById('compare-btn');
        const compareCountEl = document.getElementById('compare-count');
        
        let chart;
        let selectedToCompare = new Set();
        let currentFilters = {
            size: 'all',
            country: 'all',
            sort: 'default'
        };
        
        const createCard = (erp) => {
            const sizeMap = {
                'small': 'شركات صغيرة ومتوسطة',
                'large': 'شركات متوسطة وكبيرة',
                'all': 'جميع أحجام الشركات',
            };
            const targetAudience = erp.size.includes('all') ? sizeMap.all : erp.size.map(s => sizeMap[s]).join(' و ');

            return `
                <div class="erp-card bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 flex flex-col justify-between" data-id="${erp.id}" data-size='${JSON.stringify(erp.size)}' data-countries='${JSON.stringify(erp.countries)}'>
                    <input type="checkbox" id="compare-${erp.id}" class="card-checkbox hidden" data-id="${erp.id}">
                    <label for="compare-${erp.id}" class="block cursor-pointer border-4 border-transparent h-full flex flex-col">
                        <div class="p-6 flex-grow">
                            <div class="flex justify-between items-start">
                                <h3 class="text-xl font-bold text-slate-800 mb-2">${erp.name}</h3>
                                <div class="w-5 h-5 border-2 border-gray-300 rounded-sm flex items-center justify-center checkbox-visual flex-shrink-0">
                                     <span class="text-white text-lg hidden checkmark-symbol">✓</span>
                                </div>
                            </div>
                            <p class="text-sm text-slate-500 mb-2">${targetAudience}</p>
                            <p class="text-xs text-slate-500 mb-4">📍 متوفر في: ${erp.countries.join(', ')}</p>
                            <div class="text-2xl font-bold text-teal-600 mb-4">
                                تبدأ من ${erp.priceValue}$<span class="text-sm font-normal text-slate-500">/شهرياً</span>
                            </div>
                        </div>
                        <div class="p-6 pt-0">
                            <button class="details-btn w-full mt-auto text-center bg-slate-100 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-200 transition" data-id="${erp.id}">
                                عرض التفاصيل
                            </button>
                        </div>
                    </label>
                </div>
            `;
        };
        
        const renderCards = (data) => {
            erpGrid.innerHTML = data.map(createCard).join('');
            attachCardEventListeners();
        };

        const renderChart = (filteredData) => {
            const ctx = document.getElementById('priceChart').getContext('2d');
            if (chart) {
                chart.destroy();
            }
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: filteredData.map(d => d.name),
                    datasets: [{
                        label: 'أقل تكلفة اشتراك شهري (بالدولار)',
                        data: filteredData.map(d => d.priceValue),
                        backgroundColor: '#14b8a6', // teal-500
                        borderColor: '#0d9488', // teal-600
                        borderWidth: 1,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: { display: true, text: 'التكلفة بالدولار الأمريكي ($)', font: { size: 14, family: 'Tajawal'} },
                            ticks: { font: { family: 'Tajawal' } }
                        },
                        y: {
                            ticks: {
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label.length > 20 ? label.substring(0, 20) + '...' : label;
                                },
                                font: { family: 'Tajawal' }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            titleFont: { family: 'Tajawal', size: 16 },
                            bodyFont: { family: 'Tajawal', size: 14 },
                            rtl: true,
                            callbacks: {
                                label: function(context) {
                                    return `التكلفة: ${context.raw}$ شهرياً`;
                                }
                            }
                        }
                    }
                }
            });
        };

        const filterAndRender = () => {
            let filteredData = erpData.filter(d => {
                const sizeFilter = currentFilters.size;
                const countryFilter = currentFilters.country;

                const sizeMatch = (sizeFilter === 'all') || d.size.includes(sizeFilter) || d.size.includes('all');
                const countryMatch = (countryFilter === 'all') || d.countries.includes(countryFilter);
                
                return sizeMatch && countryMatch;
            });
            
            if (currentFilters.sort === 'lowest') {
                filteredData.sort((a, b) => a.priceValue - b.priceValue);
            } else if (currentFilters.sort === 'highest') {
                filteredData.sort((a, b) => b.priceValue - a.priceValue);
            }
            
            renderCards(filteredData);
            renderChart(filteredData);
        };
        
        const openModal = (modalEl) => {
            modalEl.classList.remove('opacity-0', 'pointer-events-none');
            modalEl.querySelector('.modal-content').classList.remove('scale-95');
        };

        const closeModal = (modalEl) => {
            modalEl.classList.add('opacity-0');
            modalEl.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => {
                modalEl.classList.add('pointer-events-none');
            }, 300);
        };
        
        const createSocialLinksHTML = (social) => {
            let html = '<div class="flex gap-4 flex-wrap">';
            if (social.linkedin) {
                html += `<a href="${social.linkedin}" target="_blank" rel="noopener noreferrer" class="social-icon" title="LinkedIn"><span class="font-bold text-lg">in</span></a>`;
            }
            if (social.twitter) {
                html += `<a href="${social.twitter}" target="_blank" rel="noopener noreferrer" class="social-icon" title="Twitter/X">
                    <canvas width="20" height="20" class="x-icon-canvas"></canvas>
                </a>`;
            }
            if (social.facebook) {
                html += `<a href="${social.facebook}" target="_blank" rel="noopener noreferrer" class="social-icon" title="Facebook"><span class="font-bold text-lg">f</span></a>`;
            }
            if (social.instagram) {
                html += `<a href="${social.instagram}" target="_blank" rel="noopener noreferrer" class="social-icon" title="Instagram"><canvas class="insta-icon-canvas" width="24" height="24"></canvas></a>`;
            }
            if (social.youtube) {
                html += `<a href="${social.youtube}" target="_blank" rel="noopener noreferrer" class="social-icon" title="YouTube"><canvas class="youtube-icon-canvas" width="24" height="24"></canvas></a>`;
            }
            if (social.tiktok) {
                html += `<a href="${social.tiktok}" target="_blank" rel="noopener noreferrer" class="social-icon" title="TikTok"><canvas class="tiktok-icon-canvas" width="24" height="24"></canvas></a>`;
            }
            html += '</div>';
            return html;
        };
        
        const drawXIcon = (canvas) => {
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.moveTo(2, 2);
            ctx.lineTo(18, 18);
            ctx.moveTo(18, 2);
            ctx.lineTo(2, 18);
            ctx.strokeStyle = 'currentColor';
            ctx.lineWidth = 2.5;
            ctx.stroke();
        };
        
        const drawYoutubeIcon = (canvas) => {
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.roundRect(2, 5, 20, 14, [4]);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(10, 9);
            ctx.lineTo(16, 12);
            ctx.lineTo(10, 15);
            ctx.closePath();
            ctx.fill();
        };
        
        const drawInstagramIcon = (canvas) => {
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createRadialGradient(7, 20, 0, 12, 12, 25);
            gradient.addColorStop(0, '#fdf497');
            gradient.addColorStop(0.05, '#fdf497');
            gradient.addColorStop(0.45, '#fd5949');
            gradient.addColorStop(0.6, '#d6249f');
            gradient.addColorStop(0.9, '#285AEB');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(0, 0, 24, 24, [6]);
            ctx.fill();

            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.roundRect(3, 3, 18, 18, [4]);
            ctx.fill();

            ctx.strokeStyle = gradient;
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            ctx.arc(12, 12, 5, 0, 2 * Math.PI);
            ctx.stroke();
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(18, 6, 1.5, 0, 2 * Math.PI);
            ctx.fill();
        };

        const drawTiktokIcon = (canvas) => {
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = 'currentColor';
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            ctx.moveTo(14, 2);
            ctx.lineTo(14, 14);
            ctx.arcTo(14, 16, 12, 16, 2);
            ctx.arcTo(10, 16, 10, 14, 2);
            ctx.lineTo(10, 11);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(14, 6, 3, 0, 2 * Math.PI);
            ctx.stroke();
        };


        const showDetails = (id) => {
            const erp = erpData.find(e => e.id === id);
            if (!erp) return;
            
            modalBody.innerHTML = `
                <h2 class="text-3xl font-bold mb-4 text-teal-600">${erp.name}</h2>
                <div class="space-y-6">
                    <div>
                        <h4 class="font-bold text-lg mb-2 border-b-2 border-slate-200 pb-2">التواجد الجغرافي</h4>
                        <p class="text-slate-700">${erp.country_notes}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mb-2 border-b-2 border-slate-200 pb-2">أبرز المميزات</h4>
                        <ul class="list-disc list-inside space-y-1 text-slate-700">
                            ${erp.features.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>
                     <div>
                        <h4 class="font-bold text-lg mb-2 border-b-2 border-slate-200 pb-2">تطبيقات الجوال</h4>
                        <p class="text-slate-700">${erp.mobile}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mb-2 border-b-2 border-slate-200 pb-2">نموذج التسعير</h4>
                        <p class="text-slate-700">${erp.priceText}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mb-2 border-b-2 border-slate-200 pb-2">ملاحظات هامة</h4>
                        <p class="text-slate-700">${erp.notes}</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mb-2 border-b-2 border-slate-200 pb-2">التواصل الاجتماعي</h4>
                        ${createSocialLinksHTML(erp.social)}
                    </div>
                    <div class="pt-4">
                        <a href="${erp.website}" target="_blank" rel="noopener noreferrer" class="btn-secondary block text-center font-bold py-3 px-6 rounded-lg">
                            زيارة الموقع الرسمي 
                            <span class="mr-2">←</span>
                        </a>
                    </div>
                </div>
            `;
            openModal(detailModal);
            document.querySelectorAll('.x-icon-canvas').forEach(drawXIcon);
            document.querySelectorAll('.youtube-icon-canvas').forEach(drawYoutubeIcon);
            document.querySelectorAll('.insta-icon-canvas').forEach(drawInstagramIcon);
            document.querySelectorAll('.tiktok-icon-canvas').forEach(drawTiktokIcon);
        };

        const updateCompareBar = () => {
             const count = selectedToCompare.size;
             if(count > 1) {
                compareBar.classList.remove('hidden');
                compareBar.classList.add('flex');
                compareCountEl.textContent = `تم تحديد ${count} أنظمة للمقارنة`;
             } else {
                compareBar.classList.add('hidden');
                compareBar.classList.remove('flex');
             }
        };
        
        const handleCheckboxChange = (checkbox) => {
             const id = checkbox.dataset.id;
             const checkmark = checkbox.nextElementSibling.querySelector('.checkmark-symbol');
             if(checkbox.checked) {
                selectedToCompare.add(id);
                checkmark.classList.remove('hidden');
             } else {
                selectedToCompare.delete(id);
                checkmark.classList.add('hidden');
             }
             updateCompareBar();
        }

        const showComparison = () => {
            const itemsToCompare = erpData.filter(erp => selectedToCompare.has(erp.id));
            if (itemsToCompare.length < 2) return;

            const features = ['مناسب لـِ', 'التواجد الجغرافي', 'أبرز المميزات والوظائف', 'تطبيقات الجوال', 'نموذج التسعير', 'ملاحظات هامة', 'التواصل الاجتماعي', 'الموقع الرسمي'];

            let tableHTML = `<table class="w-full border-collapse text-right"><thead><tr><th class="border-b-2 border-slate-300 p-4 font-bold min-w-[150px]">الميزة</th>`;
            itemsToCompare.forEach(item => {
                tableHTML += `<th class="border-b-2 border-slate-300 p-4 font-bold text-teal-600">${item.name}</th>`;
            });
            tableHTML += `</tr></thead><tbody>`;
            
            const sizeMap = { 'small': 'صغيرة ومتوسطة', 'large': 'متوسطة وكبيرة', 'all': 'جميع الأحجام' };
            
            features.forEach((feature, index) => {
                tableHTML += `<tr class="bg-white even:bg-slate-50"><td class="border-b border-slate-200 p-4 font-semibold">${feature}</td>`;
                itemsToCompare.forEach(item => {
                    let cellContent = '';
                    switch(index) {
                        case 0: cellContent = item.size.includes('all') ? sizeMap.all : item.size.map(s => sizeMap[s]).join(', '); break;
                        case 1: cellContent = item.country_notes; break;
                        case 2: cellContent = `<ul class="list-disc list-inside space-y-1">${item.features.map(f => `<li>${f}</li>`).join('')}</ul>`; break;
                        case 3: cellContent = item.mobile; break;
                        case 4: cellContent = item.priceText; break;
                        case 5: cellContent = item.notes; break;
                        case 6: cellContent = createSocialLinksHTML(item.social); break;
                        case 7: cellContent = `<a href="${item.website}" target="_blank" rel="noopener noreferrer" class="text-teal-600 hover:underline">زيارة الموقع</a>`; break;
                    }
                    tableHTML += `<td class="border-b border-slate-200 p-4 align-top">${cellContent}</td>`;
                });
                tableHTML += `</tr>`;
            });

            tableHTML += `</tbody></table>`;
            document.getElementById('compare-table-container').innerHTML = tableHTML;
            openModal(compareModal);
            document.querySelectorAll('.x-icon-canvas').forEach(drawXIcon);
            document.querySelectorAll('.youtube-icon-canvas').forEach(drawYoutubeIcon);
            document.querySelectorAll('.insta-icon-canvas').forEach(drawInstagramIcon);
            document.querySelectorAll('.tiktok-icon-canvas').forEach(drawTiktokIcon);
        };
        
        function attachCardEventListeners() {
            document.querySelectorAll('.details-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDetails(btn.dataset.id);
                });
            });

            document.querySelectorAll('.card-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', () => handleCheckboxChange(checkbox));
            });
        }
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const group = btn.dataset.filterGroup;
                document.querySelectorAll(`.${group}-filter`).forEach(b => b.classList.remove('filter-btn-active'));
                btn.classList.add('filter-btn-active');
                if (group === 'sort') {
                    currentFilters.sort = btn.dataset.sort;
                } else {
                    currentFilters[group] = btn.dataset.filter;
                }
                filterAndRender();
            });
        });
        
        closeModalBtn.addEventListener('click', () => closeModal(detailModal));
        closeCompareModalBtn.addEventListener('click', () => closeModal(compareModal));
        compareBtn.addEventListener('click', showComparison);
        
        detailModal.addEventListener('click', (e) => {
            if (e.target === detailModal) closeModal(detailModal);
        });
         compareModal.addEventListener('click', (e) => {
            if (e.target === compareModal) closeModal(compareModal);
        });

        document.addEventListener('DOMContentLoaded', () => {
            filterAndRender();
        });
    </script>
</body>
</html>
